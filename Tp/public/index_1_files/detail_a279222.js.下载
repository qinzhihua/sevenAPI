define("invest:page/uplan/detail/detail",["require","exports","module","common:widget/oui/lib/jquery/1.9.1/jquery","common:widget/oui/arale/tip/1.1.4/tip","common:widget/oui/common","common:widget/oui/protocol","common:widget/oui/widgets/widgets","common:widget/oui/components/components","common:widget/oui/arale/dialog/1.3.3/dialog","common:widget/oui/lib/handlebars/1.0.0/handlebars"],function(t,e,a){function n(){var t=document.referrer;zhuge.track("Enter Plan Detail",{source:t,plan_id:l("input[name = 'zhuge-plan-id' ]").val(),base_expected_rate:l("input[name='zhuge-plan-base-expected-rate']").val(),extra_rate:l("input[name='zhuge-plan-extra-rate']").val(),month:l("input[name='zhuge-plan-lockPeriod']").val(),min_amount:l("input[name='zhuge-plan-min-amount']").val(),plan_name:l("input[name = 'zhuge-plan-name' ]").val(),enter_max:l("input[name = 'zhuge-plan-max-amount' ]").val(),total_need_amount:l("input[name = 'zhuge-plan-amount' ]").val(),left_need_amount:l("input[name = 'zhuge-plan-left-amount' ]").val(),enter_min:l("input[name = 'zhuge-plan-min-join' ]").val(),click_time:(new Date).toString()})}function i(){n();var t=l("#pg-helper-success-hint").html();if(t){var e=null;try{e=l.parseJSON(t)}catch(a){e=null}e&&s.showMessage2({title:"U计划预定成功！",depositAmount:e.data.depositAmount,endPaymentTime:e.data.endPaymentTime,overplusAmount:e.data.overplusAmount,button:{link:"/account/invest!plan.action?planTab=RESERVATIONS",text:"立即支付"}})}var i,r="true"==l("#authenticated").text(),g="true"==l("#pg-helper-is-investor").text(),h=l("#pg-helper-be-investor-message").html(),f=l("#fullTime"),v=l("#university");if(f.length){var _=f.data("time"),w=_.match(/(\d+)天/);w=null!==w?Number(w[1]):w;var I=_;I=w>0?_.split("分")[0]+"分":_.split("天")[1],I=I.replace(/(\d)+/g,function(t){return"<i class='num-family font-30px'>"+t+"</i>"}),f.html(I)}if(v.length){var T=v.data("data");v.html(T.length?T.length>6?T.substring(0,6)+"...":T:"--")}var b=l("#counter");b.length>0&&(new u.Counter({container:b,delta:parseInt(b.data("delta"),10)}).init(),l("#counter").hasClass("ui-counter-seconds")||l("#counter").parent().children(".suffix").show());parseFloat(l("#max-account").data("account"),10);if(l("#pg-helper-has-withdraw-password").length>0){var x="true"==l("#pg-helper-has-withdraw-password").text();g=x&&g}var P,A,N,j={container:l("#investment-terminal"),authenticated:r,qualified:g,qualifiedMessage:h};if(l("#pg-plan-join, #pg-plan-index").length>0){var C=l("#plan-status").text().trim(),J=parseInt(l("#max-amount-1").data("amount"),10),k=parseInt(l("#max-amount-2").data("amount"),10);P=J>k?k:J,A=l("#share-amount").attr("data-share-amount"),N=l("#min-reg-amount").attr("data-min-reg-amount");var S=parseFloat(l("#fee-rate").data("fee-rate"),10)/100,R=parseFloat(l("#deposit-rate").data("deposit-rate"),10)/100,y=Number(l("#J_thisMaxDepositAmount").attr("data")),z=Number(l("#J_maxDepositAmount").attr("data"));R>y?R=y:R>z&&(R=z);var O;switch(C){case"RSV":O=l("#confirm-plan-reserve-template");break;case"UCODE":O=l("#use-ucode-join-template");break;case"PREMIUM":O=l("#confirm-premium-plan-join-template");break;default:O=l("#confirm-plan-join-template")}l.extend(j,{plan:{status:C},page:"plan-join",unit:"amount",template:O,amountPerShare:A,amountMinRegShare:N,maxAmount:P,maxShares:P/A,fee:S,deposit:R})}if(new c.InvestmentTerminal(j).init(),l("#plan-basic").length>0){var U=l("#plan-basic-products").data("products").split(","),B={};if(l.each(U,function(t,e){e=l.trim(e),"信用认证标"==e||"信用标"==e?B.XYRZ="信用认证标":"机构担保标"==e?B.JGDB=e:"实地认证标"==e?B.SDRZ=e:"智能理财标"==e&&(B.ZNLC=e)}),i={products:[]},l.each(B,function(t,e){i.products.push({product:t,productName:e})}),s.fillTemplate({container:l("#plan-basic-products"),template:l("#plan-basic-products-template"),data:i}),r){var q=m.translator.translate(m.API.getUserBankInfo,s.loadJSON("#account-info-rsp",!0).data);s.fillTemplate({container:l("#select-bank-accounts"),template:l("#select-bank-accounts-template"),data:q})}var D=l("#plan-begin-selling-time").data("time");D&&l("#plan-begin-selling-time").text(D.substring(0,19))}if(l("#plan-details").length>0){var E=l("#pg-helper-plan-id").text(),L=null,M=null;new u.Tab({name:"plan",switched:function(t,e,a){return a?!0:("reserve"==e&&(L=d("reserve",m.API.getPlanReserveRecords,{financePlanStr:E})),"joined"==e&&(L=d("joined",m.API.getPlanJoinedRecords,{financePlanStr:E})),"performance"==e&&new c.PlanPerformance({name:"performance",planId:E}).init(),!0)},clicked:function(t,e){M||"joined"==t&&e&&L&&L._update(L.getParams()),M=window.setTimeout(function(){window.clearTimeout(M),M=null},750)}}).init()}l("#tipCon").length&&l("#tips").length&&new p({element:"#tipCon",trigger:"#tips",direction:"right"}),l("#tipCon_0").length&&l("#tips_0").length&&new p({element:"#tipCon_0",trigger:"#tips_0",direction:"right"}),l("#tipCon_1").length&&l("#tips_1").length&&new p({element:"#tipCon_1",trigger:"#tips_1",direction:"right"}),l("#tipCon_2").length&&l("#tips_2").length&&new p({element:"#tipCon_2",trigger:"#tips_2",direction:"down",arrowShift:-22}),l("#tipCon_add1").length&&l("#tips_add1").length&&new p({element:"#tipCon_add1",trigger:"#tips_add1",direction:"right"}),o(),l(".J_click_p").on("click",function(t){var e="P"==l(t.target).get(0).tagName?l(t.target).attr("data"):l(t.target).parent(".J_click_p").attr("data");location.href="/financeplan/"+e})}function r(t,e,a){var n=parseInt(t,10),i=0,r=0,o=0;n>60&&(i=parseInt(n/60,10),n=parseInt(n%60,10),i>60&&(r=parseInt(i/60,10),i=parseInt(i%60,10)),r>24&&(o=parseInt(r/24,10),r=parseInt(r%24,10)));var p="",s="";p=o>0?""+parseInt(o,10)+"天"+parseInt(r,10)+"时":r>0?""+parseInt(r,10)+"时"+parseInt(i,10)+"分":parseInt(i,10)+"分"+parseInt(n,10)+"秒","#J_WAIT_BUTTON"==e&&(p="",p=o>0?""+parseInt(o,10)+"天"+parseInt(r,10)+"时"+parseInt(i,10)+"分":""+parseInt(r,10)+"时"+parseInt(i,10)+"分"+parseInt(n,10)+"秒",l(e).css("letter-spacing","0"),"0"===a&&(s="后开始预定"),"3"===a&&(s="开始加入"),p=p.replace(/(\d)+/g,function(t){return"<i class='num-family font-30px'>"+t+"</i>"}),l(e).html(p),l("#J_WAIT_BUTTON_TEXT")&&l("#J_WAIT_BUTTON_TEXT").html(s))}function o(){var t="#J_WAIT_BUTTON";if(l(t).length<=0||"3"!==l(t).attr("data")&&"0"!==l(t).attr("data")||"-1"===l(t).attr("data1"))return!1;var e=l(t).attr("data1"),a=setInterval(function(){e-=1,r(e,"#J_WAIT_BUTTON",l("#J_WAIT_BUTTON").attr("data")),0>=e&&(clearInterval(a),location.reload())},1e3)}var l=t("common:widget/oui/lib/jquery/1.9.1/jquery"),p=t("common:widget/oui/arale/tip/1.1.4/tip"),s=t("common:widget/oui/common"),m=t("common:widget/oui/protocol"),u=t("common:widget/oui/widgets/widgets"),c=t("common:widget/oui/components/components"),d=(t("common:widget/oui/arale/dialog/1.3.3/dialog"),t("common:widget/oui/lib/handlebars/1.0.0/handlebars"),u.GoTop(),function(t,e,a){var n=new u.List({name:t,api:e,title:!0,params:a,container:l("#"+t+"-records"),rendered:function(t){{var a=t.status,n=t.data;m.translator}if(0===a&&e==m.API.getPlanJoinedRecords){l("#joined-count").text(n.jsonList.length);var i=0;l.each(n.jsonList,function(t,e){i+=Number(e.amount.replace(/,/g,""))});var r=parseInt(i,10);r=r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),l("#reserve-had-pay-amount").html(r)}if(0===a&&e==m.API.getPlanReserveRecords){var o=0;l.each(n.rsvList,function(t,e){"未支付"==e.status&&(o+=e.planAmountNotComma)}),l("#reserve-not-pay-amount").html(o),l("#reserve-count").text(n.rsvList.length)}}}).init();return n._update(n.getParams()),n}),g={init:i};a.exports=g});